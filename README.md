# Telegram bot для сотрудников студии йоги, дополняющий crm системы fitbase.

## Функции:
### Создание актов зарплаты по отчетам из fitbase
Поддерживаются 2 вида отчётов, определяются автоматически:
#### 1. Отчёт по прадажам.
Формируются акты для сотрудников с ролью "Администратор". На основании суммы
персональных продаж и фиксированного процента (см. Константы) рассчитывается
премиальная часть. На основании графика работы сотрудников и часовой ставки
рассчитывается оклад.\
Пример акта

#### 2. История начислений зарплат тренеров
Формируются акты для сотрудников с ролью "Тренер". Начисления группируются по
названию и сумме, подсчитывается общая сумма.\
Пример акта

### Уведомление кассира о входящей онлайн оплате
Отправка сообщений

### Просмотр графика работы администраторов
Для пользователей с ролью "Администратор" доступен просмотр собственного графика\
![alt text](https://github.com/grachevvladislav/report-generator/blob/main/examples/admin_schedule.png?raw=true)\
Для пользователя "stuff" - график всех сотрудников\
![alt text](https://github.com/grachevvladislav/report-generator/blob/main/examples/full_schedule.png?raw=true)

## Структура и взаимодействие с внешними сервисами.
Для хранения информации используются две таблицы google sheet.
#### 1. График работы [(пример)](examples/administrator_db.xlsx)
Имя листа - год

| - | A          | B                    | C     |
|---|------------|----------------------|-------|
| 1 | Дата       | Администратор        | Время |
| 2 | 01.01.2024 | Иванов Иван Иванович | 8,5   |
| 3 | 02.01.2024 | Петров Петр Петрович |       |

#### 2. Настройки и персональная информация [(пример)](examples/bot_settings.xlsx)
**Лист "document_counter" - счётчик актов в ячейке `A1`**

| - | A          |
|---|------------|
| 1 | 1          |

- Поле хранит номер последнего акта. Обновляется при подтверждении
правильности формирования актов.

**Лист "employees" - Информация о сотрудниках**

| - | A                    | B    | C                                          | D                    | E                  | F      | G                     | H                | I              | J           | K             | L      |
|---|----------------------|------|--------------------------------------------|----------------------|--------------------|--------|-----------------------|------------------|----------------|-------------|---------------|--------|
| 1 | fio                  | inn  | address                                    | checking_account     | bank               | bik    | correspondent_account | agreement_number | agreement_date | telegram_id | role          | active |
| 2 | Иванов Иван Иванович | 1234 | ул. Борисовские Пруды, 26, корп. 2, Москва | 98765432123456788765 | АО «Альфа-Банк»    | 775676 | 0987654321            | 01               | 19.01.2024     | 700         | Администратор | Да     |
| 3 | Петров Петр Петрович | 5678 | ул. Верхние Поля, 32, корп. 1, Москва      | 34567876543456787654 | АО «Тинькофф Банк» | 576576 | 9876543               | 02               | 19.01.2024     |             | Тренер        | Да     |

- `fio` - ФИО сотрудника. Заполняется строго полностью.
- `telegram_id` - id сотрудника
- `role` - может иметь значения `Администратор`, `Тренер` или `stuff`. Используется для выбора работы бота с сотрудником.
- `active` - может иметь значения `Да` или `Нет`. Используется для полного
выведения сотрудника из процесса обработки.\
Остальные поля заполняются любыми значениями исходя из их названий.

**Лист "constants" - Константы**

## Обязательные файлы
- pattern.docx - шаблон акта
- employees.json - данные сотрудников
- act_counter.txt - файл с номером последнего акта

## Переменные в докуменете
#### Общие
- act_number - сквозной номер акта
- date - текущая дата
- from - начало периода
- to - конец периода
#### Информация о сотруднике:
- FIO - ФИО исполнителя полностью
- INN - ИНН
- address - Адрес
- checking_account - номер счёта
- bank - название банка
- bik - БИК
- correspondent_account - кор. счёт
- agreement_number - номер договора
- agreement_date - дата договора
- FIO_short - Фимилия И.О.
